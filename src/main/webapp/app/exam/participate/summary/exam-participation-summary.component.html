<jhi-test-run-ribbon *ngIf="isTestRun"></jhi-test-run-ribbon>
<div>
    <h2>
        <ng-container *ngIf="!instructorView">
            {{ 'artemisApp.exam.examSummary.yourSubmissionTo' | translate: { examTitle: studentExam.exam!.title!, studentName: studentExam.user!.name! } }}
        </ng-container>
        <ng-container *ngIf="instructorView">
            {{ 'artemisApp.exam.examSummary.studentSubmissionTo' | translate: { examTitle: studentExam.exam!.title!, studentName: studentExam.user!.name! } }}
        </ng-container>
        <button class="btn btn-primary float-right" (click)="printPDF()">
            <fa-icon [icon]="'print'"></fa-icon>
            <span jhiTranslate="artemisApp.exam.examSummary.exportPDF">Export PDF</span>
        </button>
    </h2>
</div>
<jhi-exam-information [exam]="studentExam.exam" [studentExam]="studentExam"></jhi-exam-information>
<div class="mb-4" *ngIf="studentExam && studentExam.exercises && studentExam.exam">
    <jhi-exam-points-summary [exercises]="studentExam.exercises" [exam]="studentExam.exam"></jhi-exam-points-summary>
</div>
<h4 class="mb-0">{{ 'artemisApp.exam.exercises' | translate }}</h4>
<div *ngFor="let exercise of studentExam.exercises; let i = index">
    <div class="question card">
        <div class="question-options card-header question-card-header">
            <h5>
                &nbsp;<fa-icon [icon]="getIcon(exercise.type)"></fa-icon>&nbsp;
                <span jhiTranslate="artemisApp.exam.exercise" [translateValues]="{ nr: i + 1 }">Exercise {{ i + 1 }}</span>
            </h5>
            <div *ngIf="resultsPublished">
                <jhi-result [participation]="exercise.studentParticipations![0]"></jhi-result>
            </div>
            <button
                class="btn btn-light question-collapse"
                (click)="toggleCollapseExercise(exercise.id)"
                [attr.aria-expanded]="!isCollapsed(exercise.id)"
                [attr.aria-controls]="isCollapsed(exercise.id)"
            >
                <fa-icon size="2x" [icon]="isCollapsed(exercise.id) ? 'angle-right' : 'angle-down'"></fa-icon>
            </button>
        </div>
        <div class="card-body question-card-body" [ngbCollapse]="isCollapsed(exercise.id)">
            <div *ngIf="exercise.type !== QUIZ && exercise.type !== PROGRAMMING && resultsPublished">
                <button
                    *ngIf="exercise.studentParticipations && exercise.studentParticipations.length > 0"
                    class="btn btn-primary float-right"
                    [routerLink]="generateLink(exercise)"
                >
                    <fa-icon [icon]="'folder-open'" [fixedWidth]="true"></fa-icon><span jhiTranslate="artemisApp.exam.examSummary.viewResult">&nbsp;View Result</span>
                </button>
            </div>
            <h5>{{ exercise.title }} [{{ exercise.maxScore }}p]</h5>
            <h6 right-body class="markdown-preview" *ngIf="exercise.problemStatement && exercise.type !== PROGRAMMING">
                <span [innerHTML]="exercise.problemStatement! | htmlForMarkdown"></span>
            </h6>
            <jhi-programming-exercise-instructions
                *ngIf="exercise.problemStatement && exercise.type === PROGRAMMING"
                [exercise]="exercise"
                [participation]="exercise.templateParticipation"
            ></jhi-programming-exercise-instructions>
            <ng-container *ngIf="exercise.type !== PROGRAMMING">
                <!-- Show submission of student - if no submission found -> display that student did not participate -->
                <ng-container
                    *ngIf="getParticipationForExercise(exercise) && getSubmissionForExercise(exercise) && getSubmissionForExercise(exercise)?.submitted; else noSubmission"
                >
                    <!-- Text Exercise -->
                    <ng-container *ngIf="exercise.type === TEXT">
                        <jhi-text-exam-summary [submission]="getSubmissionForExercise(exercise)"></jhi-text-exam-summary>
                    </ng-container>
                    <!-- Modeling Exercise -->
                    <ng-container *ngIf="exercise.type === MODELING">
                        <jhi-modeling-exam-summary [exercise]="exercise" [submission]="getSubmissionForExercise(exercise)"></jhi-modeling-exam-summary>
                    </ng-container>
                    <!-- Quiz Exercise -->
                    <ng-container *ngIf="exercise.type === QUIZ">
                        <jhi-quiz-exam-summary
                            [exercise]="exercise"
                            [exam]="studentExam.exam"
                            [submission]="getSubmissionForExercise(exercise)"
                            [resultsPublished]="resultsPublished"
                        ></jhi-quiz-exam-summary>
                    </ng-container>
                    <!-- File Upload Exercise -->
                    <ng-container *ngIf="exercise.type === FILE_UPLOAD">
                        <jhi-file-upload-exam-summary [submission]="getSubmissionForExercise(exercise)"></jhi-file-upload-exam-summary>
                    </ng-container>
                    <jhi-complaint-interactions
                        *ngIf="getSubmissionForExercise(exercise) && exercise.type !== QUIZ && isAfterStudentReviewStart()"
                        class="mb-2 mt-2 ml-3"
                        [exercise]="exercise"
                        [participation]="getParticipationForExercise(exercise)"
                        [exam]="examWithOnlyIdAndStudentReviewPeriod"
                        [testRun]="isTestRun"
                    >
                    </jhi-complaint-interactions>
                </ng-container>
            </ng-container>
            <ng-container *ngIf="exercise.type === PROGRAMMING">
                <!--  relax condition for programming exercises for the case that we get a submissions from websockets, but last changes in exam were not submitted -->
                <ng-container *ngIf="getParticipationForExercise(exercise) && getSubmissionForExercise(exercise); else noSubmission">
                    <!-- Programming Exercise -->
                    <jhi-programming-exam-summary
                        [exercise]="exercise"
                        [participation]="getParticipationForExercise(exercise)"
                        [submission]="getSubmissionForExercise(exercise)"
                    ></jhi-programming-exam-summary>
                </ng-container>
                <jhi-complaint-interactions
                    *ngIf="exercise.assessmentType === AssessmentType.SEMI_AUTOMATIC && getSubmissionForExercise(exercise) && isAfterStudentReviewStart()"
                    class="mb-2 mt-2 ml-3"
                    [exercise]="exercise"
                    [participation]="getParticipationForExercise(exercise)"
                    [exam]="examWithOnlyIdAndStudentReviewPeriod"
                    [testRun]="isTestRun"
                >
                </jhi-complaint-interactions>
            </ng-container>
            <ng-template #noSubmission>
                {{ 'artemisApp.exam.examSummary.noSubmissionFound' | translate }}
            </ng-template>
        </div>
    </div>
</div>
